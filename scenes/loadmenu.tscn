[gd_scene load_steps=2 format=3 uid="uid://lk2t5f8fqqfl"]

[sub_resource type="GDScript" id="GDScript_w6coo"]
script/source = "extends Control

@onready var savesList = $CenterContainer/SaveContainer/SaveList
@onready var backButton = $CenterContainer/BackButton
@onready var title = $CenterContainer/Title

func _ready():
	backButton.pressed.connect(onBackPressed)
	savesList.size_flags_horizontal = Control.SIZE_FILL | Control.SIZE_EXPAND
	savesList.size_flags_vertical = Control.SIZE_FILL | Control.SIZE_EXPAND
	savesList.item_activated.connect(func(index):
		var save_name = savesList.get_item_text(index) + \"_inventory.json\"
		loadSave(save_name)
	)
	populateSaves()

func populateSaves():
	savesList.clear()
	var saves = SaveManager.getSaves()
	for save in saves:
		var displayName = save.replace(\"_inventory.json\", \"\")
		savesList.add_item(displayName)

func onBackPressed():
	get_tree().change_scene_to_file(\"res://scenes/menu.tscn\")

func loadSave(file_name: String):
	var data = SaveManager.loadSave(file_name.replace(\".json\", \"\"))
	get_tree().change_scene_to_file(\"res://scenes/CharacterSelect.tscn\")

func getSaves() -> Array:
	var dir = DirAccess.open(\"user://\")
	var saves = []

	if dir:
		dir.list_dir_begin()
		var file_name = dir.get_next()

		while file_name != \"\":
			if file_name.ends_with(\".json\"):
				saves.append(file_name)

			file_name = dir.get_next()

		dir.list_dir_end()

	return saves
"

[node name="Loadmenu" type="Control"]
layout_mode = 3
anchors_preset = 0
script = SubResource("GDScript_w6coo")

[node name="CenterContainer" type="VBoxContainer" parent="."]
layout_mode = 0
offset_right = 204.0
offset_bottom = 62.0

[node name="Title" type="Label" parent="CenterContainer"]
layout_mode = 2
text = "Selecione um personagem"

[node name="SaveContainer" type="VBoxContainer" parent="CenterContainer"]
layout_mode = 2
size_flags_vertical = 3
size_flags_stretch_ratio = 0.0

[node name="SaveList" type="ItemList" parent="CenterContainer/SaveContainer"]
layout_mode = 2
select_mode = 1
allow_reselect = true
auto_width = true
auto_height = true
max_columns = 15

[node name="BackButton" type="Button" parent="CenterContainer"]
layout_mode = 2
text = "Voltar"
